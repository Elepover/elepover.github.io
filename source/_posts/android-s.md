---
title: ä¸ä½¿ç”¨ TWRPï¼Œä¸ºä½ çš„ Pixel è®¾å¤‡åˆ·å…¥ Android 12 å’Œ Magisk
date: 2021-05-19 00:00:00
tags:
- android
- "android 12"
- "android s"
- google
- pixel
- phone
thumbnail: /pic/android-s.png
---

Android 11 çš„ç»§ä»»è€…ï¼ŒAndroid 12 (S) å·²ç»æ¨å‡ºäº†ç¬¬ä¸€ä¸ªå…¬å…± beta ç‰ˆï¼Œå¹¶å‘ Pixel ç­‰è®¾å¤‡å¼€æ”¾ä½¿ç”¨ã€‚

ä½† TWRP ä¹‹ç±»çš„ç¬¬ä¸‰æ–¹ Recovery å¯èƒ½è¿˜æ²¡åšå¥½ Android 12 çš„æ”¯æŒï¼Œæ˜¯ä¸æ˜¯ Magisk å°±æ— æœ›äº†å‘¢ï¼Ÿå…¶å®å¹¶ä¸ã€‚

<!-- more -->

è·Ÿéšè¿™ç¯‡æ–‡ç« çš„æ­¥éª¤ï¼Œä½ å°†å¯ä»¥ï¼š

- âœ“ åˆ·å…¥æœ€æ–°çš„ Android 12 Public Beta
- âœ“ åœ¨æ— éœ€ç¬¬ä¸‰æ–¹ Recovery çš„æƒ…å†µä¸‹åˆ·å…¥ Magisk

## 0x0 å‡†å¤‡å·¥ä½œ

ä½ å°†éœ€è¦ï¼š

- Android Platform Tools
  - [Windows](https://dl.google.com/android/repository/platform-tools-latest-windows.zip)
  - macOS
    - Homebrew: `brew install android-platform-tools`
    - [ç›´æ¥ä¸‹è½½](https://dl.google.com/android/repository/platform-tools-latest-darwin.zip)
  - Linux: ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…æˆ–è€…[ç›´æ¥ä¸‹è½½](https://dl.google.com/android/repository/platform-tools-latest-darwin.zip)
- [Android 12 åŸå‚é•œåƒ](https://developer.android.com/about/versions/12/download#factory-images)
- [Magisk 23.0](https://github.com/topjohnwu/Magisk/releases/download/v23.0/Magisk-v23.0.apk) æˆ–æ›´é«˜ç‰ˆæœ¬
- è§£é”çš„ Bootloader

> ğŸ’¡ è¿™ç¯‡æ–‡ç« é‡Œå°†å¦‚åŒè¿™æ ·æ ‡è®°æˆ‘åœ¨å®‰è£…è¿‡ç¨‹ä¸­è¸©çš„å‘ä»¥åŠå¦‚ä½•å›é¿ã€‚è¿˜æœ‰ä¸€äº›å°æç¤ºã€‚
> 
> ä¸ªäººé…ç½®:
> - Pixel 3 (åˆ·å…¥æ—¶ç‰ˆæœ¬ä¸º Android 11, `RQ2A.210505.002`ï¼Œ2021 å¹´ 5 æœˆ)
> - macOS Catalina 10.15.7
> - Magisk 23.0
>
> æ—¢ç„¶ä½ æ˜¯ Pixel ç”¨æˆ·ï¼Œæˆ‘ä»¬åˆ™å‡è®¾ä½ å·²ç»æœ‰ä¸€å®šçš„åŸºæœ¬çŸ¥è¯†ã€‚Platform Tools å®‰è£…ï¼Œæ§åˆ¶å°äº¤äº’ä½¿ç”¨ä¹‹ç±»å†…å®¹å°†ä¸å†äºæ­¤èµ˜è¿°ã€‚

> ğŸ’¡ æˆ‘ä»¬ä½¿ç”¨ç›´æ¥åˆ·å…¥åŸå‚é•œåƒçš„æ–¹å¼ï¼Œä¸éœ€è¦åœ¨ [Android Beta è®¡åˆ’](https://www.google.com/android/beta#devices)æ³¨å†Œå³å¯ä½¿ç”¨ã€‚ä½†ä½ å¦‚æœå¸Œæœ›æ”¶åˆ°ååºç‰ˆæœ¬çš„ OTA æ›´æ–°ï¼Œè¯·åœ¨è®¾å¤‡ä¸Šç™»å½•ä½ çš„ Google è´¦æˆ·ï¼Œå¹¶åœ¨ç½‘é¡µä¸­é€‰æ‹©æ³¨å†Œä½ çš„è®¾å¤‡ã€‚

å½“ä½ å‡†å¤‡å¥½ä»¥ä¸Šå·¥å…·åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹äº†ã€‚

## 0x1 è§£é” Bootloader

> ğŸ’¡ å¦‚æœä½ çš„ Bootloader å·²ç»è§£é”ï¼Œè¯·æš‚æ—¶ä¸è¦è·³è¿‡æ­¤èŠ‚ã€‚

### å¤‡ä»½ä½ çš„æ•°æ®

**å¦‚æœä½ çš„ Bootloader è¿˜æœªè§£é”**ï¼Œç«‹åˆ»å¤‡ä»½ä½ çš„æ•°æ®ï¼

åœ¨ Bootloader è§£é”è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰åº”ç”¨æ•°æ®ã€ç³»ç»Ÿè®¾ç½®ç­‰å°†åœ¨è§£é”è¿‡ç¨‹ä¸­è¢«å½»åº•æŠ¹å»ï¼Œåœ¨ä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½ä½ çš„æ•°æ®ã€‚

**å¦‚æœä½ çš„ Bootloader å·²ç»è§£é”**ï¼Œç«‹åˆ»å¤‡ä»½ä½ çš„æ•°æ®ï¼

åˆ·å…¥åŸå‚é•œåƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä»ç„¶ä¼šè¢«ä¸€å¹¶æŠ¹å»ï¼Œè¯·åŠ¡å¿…åœ¨å¼€å§‹å‰å¤‡ä»½ä½ çš„æ•°æ®ã€‚

### é€€å‡º Google è´¦æˆ·

> ğŸ’¡ å¦‚æœä½ çš„ Bootloader å·²ç»è§£é”ï¼Œå³ä½¿ FRP åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨ç¦ç”¨ï¼Œä½†ä»ç„¶å»ºè®®ä½ æ‰§è¡Œè¿™ä¸€æ­¥éª¤ä»¥é˜²ä¸‡ä¸€ã€‚ä½ å¯ä»¥è·³è¿‡æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†ã€‚

åœ¨ `è®¾ç½® > å¸å·` ä¸­é€€å‡ºä½ çš„ Google è´¦æˆ·ç™»å½•ã€‚

### å…è®¸ Bootloader è§£é”

åœ¨ `è®¾ç½® > å…³äºæ‰‹æœº` ä¸­æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œè¿ç»­ç‚¹å‡»ã€Œç‰ˆæœ¬å·ã€ï¼Œç›´åˆ°è§£é”å¼€å‘è€…é€‰é¡¹ã€‚

å‰å¾€ `è®¾ç½® > ç³»ç»Ÿ > å¼€å‘è€…é€‰é¡¹`ï¼Œæ‰“å¼€ã€ŒOEM è§£é”ã€å¼€å…³ã€‚

### è¿›å…¥ Bootloader

å…³æœºæˆ–é‡å¯ï¼Œå¼€æœºæ—¶ä¿æŒæŒ‰ä½ã€ŒéŸ³é‡å‡ã€é”®ï¼Œç›´åˆ°ä½ çœ‹åˆ°æœ‰çº¢è‰² âš ï¸ æ„Ÿå¹å·åŠçº¢è‰² "Fastboot mode" å­—æ ·æ—¶å³å¯æ¾æ‰‹ã€‚

> ğŸ’¡ å¦‚æœä½ é€‰æ‹©é‡å¯ï¼Œåˆ™ä¸éœ€è¦æŒ‰ç”µæºé”®ï¼Œä¿æŒæŒ‰ä½ã€ŒéŸ³é‡å‡ã€é”®å³å¯ã€‚
>
> å¦‚æœä½ ç›´æ¥å¼€æœºï¼Œè¯·å¿«é€Ÿæ”¾å¼€ç”µæºé”®ï¼Œå¦åˆ™å¯èƒ½è¢«è¯†åˆ«æˆã€Œå¼€æœºã€å¯¼è‡´ç›´æ¥è¿›å…¥ç³»ç»Ÿã€‚
>
> å½“ç„¶ï¼Œå¦‚æœä½ å¯ç”¨äº† USB è°ƒè¯•ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ `adb reboot bootloader`ï¼Œè¿™æ˜¯æœ€ç¨³å®šçš„æ–¹æ³•ã€‚

### è§£é”

ä½¿ç”¨ `fastboot flashing unlock` è§£é” Bootloaderï¼Œå¹¶åœ¨æ‰‹æœºä¸Šä½¿ç”¨éŸ³é‡é”®é€‰æ‹©ã€ŒUnlockã€ï¼ŒæŒ‰ç”µæºé”®ç¡®è®¤è§£é” Bootloader.

> âš ï¸ å¦‚æœé€‰æ‹©ç¡®è®¤ï¼Œä½ çš„æ•°æ®å°†åœ¨è¿™ä¸€æ­¥è¢«æ¸…é™¤ï¼Œè¯·ç¡®è®¤ä½ å·²ç»å¤‡ä»½äº†é‡è¦æ•°æ®ã€‚

> ğŸ’¡ éƒ¨åˆ† Pixel 2 XL æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‘½ä»¤ï¼š`fastboot flashing unlock_critical`ï¼Œä½†ç”±äº Android 12 å¹¶æ²¡æœ‰å¯¹ Pixel 2 ç³»åˆ—çš„å®˜æ–¹æ”¯æŒï¼Œæ‰€æœ‰æ”¯æŒçš„è®¾å¤‡å‡ä½¿ç”¨ä¸Šè¿°å‘½ä»¤å³å¯ã€‚

## 0x2 åˆ·å…¥ Android 12

1. æ‰¾åˆ°æˆ‘ä»¬åˆšåˆšä¸‹è½½çš„ Android 12 åŸå‚é•œåƒï¼Œè§£å‹ zip.
   > ğŸ’¡ å¦‚æœä½ ä½¿ç”¨ Linux æˆ– macOSï¼Œè¯·ç¡®å®š `flash-all.sh` æœ‰æ‰§è¡Œæƒé™ï¼Œè‹¥è¦æ·»åŠ æ‰§è¡Œæƒé™ï¼Œè¯·è¿è¡Œ `chmod +x flash-all.sh`
2. [è¿›å…¥ Bootloader](#è¿›å…¥-bootloader).
3. åˆ·å…¥ Android 12
   - å¦‚æœä½ æ˜¯ Windows ç”¨æˆ·ï¼Œæ‰§è¡Œ `flash-all.bat`
   - å¦‚æœä½ æ˜¯ Linux æˆ– macOS ç”¨æˆ·ï¼Œæ‰§è¡Œ `./flash-all.sh`
4. ç­‰å¾…åˆ·å…¥è„šæœ¬æ‰§è¡Œå®Œæ¯•

è‡³æ­¤ï¼ŒAndroid 12 åˆ·å…¥å®Œæ¯•ã€‚

## 0x3 æ‰“è¡¥ä¸

é€‚ç”¨äº Pixel 3 çš„ TWRP åœæ›´åœ¨äº† 3.3.0 ä¸”ä¸æ”¯æŒ Android 10 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œäºæ˜¯ç›´æ¥åˆ·å…¥ Magisk åŒ…çš„æ–¹æ³•å°±æ— æ³•ä½¿ç”¨äº†ã€‚

1. æ­£å¸¸è¿›å…¥ç³»ç»Ÿï¼Œæ­£å¸¸å®Œæˆè®¾ç½®
2. [è§£é”å¼€å‘è€…é€‰é¡¹](#å…è®¸-bootloader-è§£é”)ï¼Œæ‰“å¼€ã€ŒUSB è°ƒè¯•ã€
3. å®‰è£…ä¸‹è½½å¥½çš„ Magisk å®‰è£…åŒ…: `adb install Magisk-v23.0.apk`
   > ğŸ’¡ ç¦ç”¨ Google Play Protect å¯ä»¥æ˜¾è‘—æé«˜å®‰è£…é€Ÿåº¦ã€‚
4. æ‰¾åˆ°æˆ‘ä»¬åˆšåˆšè§£å‹çš„ zipï¼Œå…¶ä¸­è¿˜æœ‰ä¸€ä¸ª zipï¼Œåå­—ç±»ä¼¼ä¸º
   > `image-è®¾å¤‡ä»£å·-ç‰ˆæœ¬å·.zip`ï¼Œå¦‚ `image-blueline-spb1.210331.013.zip`
5. å°†å…¶è§£å‹ï¼Œæ‰¾åˆ° `boot.img`
6. æ¨é€åˆ°æ‰‹æœº: `adb push boot.img /sdcard`
7. åœ¨ Magisk åº”ç”¨ä¸­ï¼Œé€‰æ‹©ã€ŒMagiskã€å¡ç‰‡ä¸Šçš„ã€Œå®‰è£…ã€
8. é€‰æ‹©ã€Œé€‰æ‹©å¹¶ä¿®è¡¥ä¸€ä¸ªæ–‡ä»¶ã€ï¼Œå†é€‰ä¸­æˆ‘ä»¬åˆšåˆšæ¨é€åˆ°æ‰‹æœºä¸Šçš„ `boot.img`
   > ğŸ’¡ Magisk æ‰“å®Œè¡¥ä¸åï¼Œæ–‡ä»¶åå°†æœ‰ä¸€å—éšæœºéƒ¨åˆ†ï¼Œå»ºè®®æå‰æ”¹åä»¥ä¾¿æ‹‰å–å’Œåˆ·å…¥ã€‚
   >
   > âš ï¸ è¯·å‹¿ç›´æ¥å¤åˆ¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤ã€‚
9. å¾… Magisk æ‰“å®Œè¡¥ä¸åï¼Œå°†æ­¤æ–‡ä»¶ä»æ‰‹æœºä¸­æ‹‰è‡³ç”µè„‘: `adb pull /sdcard/Download/Magisk-xxx.img`
10. é‡å¯åˆ° Bootloader
    > ğŸ’¡ æˆ‘ä»¬å·²ç»ç”¨ä¸Š ADB äº†ï¼Œè·‘ `adb reboot bootloader` å³å¯ã€‚
11. **å¯åŠ¨**æ‰“è¡¥ä¸åçš„ `boot.img`: `fastboot boot Magisk-xxx.img`
    > âš ï¸ Pixel 3, Pixel 5 å·²ç¡®å®šï¼Œå…¶å®ƒ Pixel è®¾å¤‡å¯èƒ½åŒæ ·å—å½±å“ã€‚
    >
    > ç›´æ¥åˆ·å…¥ Magisk ä¿®è¡¥åçš„ `boot.img` å°†å¯¼è‡´æ— æ³•å¯åŠ¨ï¼Œ**è¯·ä¸è¦ä½¿ç”¨** `fastboot flash boot Magisk-xxx.img` ç›´æ¥åˆ·å…¥ï¼

æ­¤æ—¶ä½ è¾¾åˆ°äº†ã€Œä¸´æ—¶ rootã€çš„æ•ˆæœï¼Œé‡å¯åå°†å¤±æ•ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿å®ƒã€Œæ°¸ä¹…åŒ–ã€ã€‚

## 0x4 æ°¸ä¹…åŒ–åˆ·å…¥ Magisk

1. å›åˆ° Magisk åº”ç”¨
2. é€‰æ‹©ã€ŒMagiskã€å¡ç‰‡ä¸Šçš„ã€Œå®‰è£…ã€
   > ğŸ’¡ æ­¤æ—¶ï¼Œä½ ä¼šå‘ç°æ¯”èµ·ä¹‹å‰å¤šäº†ä¸€ä¸ªé€‰é¡¹ï¼Œè€Œå®ƒæ°å¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚
3. é€‰æ‹©ã€Œç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰ã€
4. å¾… Magisk åˆ·å…¥å®Œæˆä»¥åï¼Œé‡å¯å³å¯

## 0x5 å®Œæˆ

å…¨éƒ¨å·¥ä½œæ­£å¼å®Œæˆï¼æ¥ä¸‹æ¥å¯ä»¥æ¢å¤æ•°æ®ï¼Œæ­£å¸¸ä½¿ç”¨äº†ã€‚

## -0x1 ä»¥é˜²ä¸‡ä¸€

å¦‚æœé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

- å¡åœ¨ Googleã€ŒGã€å¼€æœºåŠ¨ç”»
- Google logo å‡ºç°åç›´æ¥é»‘å±é‡å¯
- å›åˆ° Bootloader ç•Œé¢ï¼Œ"Enter reason" æ˜¾ç¤º `no valid slot to boot`

é‚£ä¹ˆå¾ˆä¸å¹¸ï¼Œåˆ·å…¥çš„ `boot.img` å‡ºäº†é—®é¢˜ï¼Œè‹¥è¦åœ¨ä¸ä¸¢å¤±æ•°æ®çš„æƒ…å†µä¸‹æ¢å¤å¯åŠ¨ï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆšåˆšè§£å‹çš„åŸå‚ `boot.img`ï¼Œè¿è¡Œ `fastboot flash boot boot.img`ï¼Œé‡å¯å³å¯ã€‚

> ğŸ’¡ å¦‚æœé­é‡ `no valid slot to boot`ï¼Œå¾ˆæœ‰å¯èƒ½ç°åœ¨çš„å¯åŠ¨æ§½ä½ä¸æ˜¯å½“å‰ç³»ç»Ÿæ‰€åœ¨æ§½ä½ï¼Œè¯·åˆ‡æ¢æ§½ä½åå†åˆ·å…¥ `boot.img`
>
> åŸç†æ˜¯ï¼šåŸæœ¬çš„å¯åŠ¨æ§½ä½å¯åŠ¨å¤±è´¥åï¼Œè‡ªåŠ¨å›è½åˆ°å¦ä¸€ä¸ªå¯åŠ¨æ§½ä½ï¼Œå¦‚æœä»ç„¶å¯åŠ¨å¤±è´¥å°±ä¼šå›åˆ° Bootloaderï¼Œç­‰å¾…æ•‘æ´æ“ä½œã€‚
>
> æ£€æŸ¥ Fastboot ç•Œé¢æ˜¾ç¤ºçš„ã€ŒBoot slotã€ï¼Œå¦‚æœæ˜¯ `b`ï¼Œåˆ™åˆ‡æ¢åˆ° `a`ï¼Œåä¹‹åˆ™åˆ‡æ¢åˆ° `b`.
>
> æ¯”å¦‚ï¼Œåˆ‡æ¢åˆ° `a` æ§½ä½ï¼Œè¯·ä½¿ç”¨å‘½ä»¤: `fastboot --set-active=a`
